<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Menu Premium - Kampoeng Kelongs</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    :root {
      --primary: #e63946;
      --bg: #f5f5f5;
      --text: #1c1c1e;
      --card-bg: white;
      --shadow: rgba(0,0,0,0.1);
    }

    [data-theme="dark"] {
      --bg: #1c1c1e;
      --text: #f5f5f5;
      --card-bg: #2c2c2e;
      --shadow: rgba(255,255,255,0.1);
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      transition: background 0.3s, color 0.3s;
    }

    .navbar {
      background: var(--card-bg);
      box-shadow: 0 2px 10px var(--shadow);
    }

    .product-card {
      background: var(--card-bg);
      border: none;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 4px 15px var(--shadow);
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px var(--shadow);
    }

    .product-card img {
      height: 200px;
      object-fit: cover;
      border-bottom: 1px solid var(--shadow);
    }

    .fade-in {
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .pagination .page-link {
      color: var(--primary);
    }

    .pagination .active .page-link {
      background: var(--primary);
      border-color: var(--primary);
    }

    footer {
      background: var(--card-bg);
      padding: 20px 0;
      text-align: center;
      box-shadow: 0 -2px 10px var(--shadow);
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand fw-bold" href="#">Kampoeng Kelongs Premium</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarContent">
        <form class="d-flex mx-auto" style="max-width: 400px;">
          <input id="search-input" class="form-control me-2" type="search" placeholder="Cari menu..." aria-label="Search">
        </form>
        <ul class="navbar-nav ms-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="categoryDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Kategori
            </a>
            <ul id="category-menu" class="dropdown-menu" aria-labelledby="categoryDropdown">
              <!-- Kategori dirender di sini -->
            </ul>
          </li>
          <li class="nav-item">
            <button id="cart-btn" class="nav-link btn position-relative" data-bs-toggle="modal" data-bs-target="#cartModal">
              <i class="bi bi-cart"></i>
              <span id="cart-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display: none;">0</span>
            </button>
          </li>
          <li class="nav-item">
            <div class="form-check form-switch ms-3">
              <input class="form-check-input" type="checkbox" id="darkModeToggle">
              <label class="form-check-label" for="darkModeToggle"><i class="bi bi-moon-stars"></i></label>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container my-5">
    <div id="product-grid" class="row row-cols-1 row-cols-md-3 g-4">
      <!-- Produk dirender di sini -->
    </div>
    <nav aria-label="Pagination" class="d-flex justify-content-center mt-4">
      <ul id="pagination" class="pagination">
        <!-- Pagination buttons -->
      </ul>
    </nav>
  </div>

  <!-- Cart Modal -->
  <div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="background: var(--card-bg); color: var(--text);">
        <div class="modal-header">
          <h5 class="modal-title" id="cartModalLabel">Keranjang Belanja</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <ul id="cart-list" class="list-group"></ul>
          <p class="mt-3 fw-bold">Total: Rp <span id="cart-total">0</span></p>
        </div>
        <div class="modal-footer">
          <button id="clear-cart" type="button" class="btn btn-danger">Kosongkan Keranjang</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="container">
      <p>&copy; 2025 Kampoeng Kelongs. All rights reserved. | Hubungi kami: wa.me/6281234567890 | Ikuti kami di X: @kampoengkelongs</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const apiUrl = 'https://script.google.com/macros/s/AKfycby9ouMAhiw_hqP4OY8l4uIjzxsB8l6qNu_YJ9Ww8HZfptcAVaGz8kH-NsSCtKPi3R5xdQ/exec';
    let allProducts = [];
    let filteredProducts = [];
    const itemsPerPage = 6;
    let currentPage = 1;

    // Fetch data
    fetch(apiUrl)
      .then(response => response.json())
      .then(data => {
        allProducts = data.map(p => ({
          nama: p['Nama Produk'] || 'Tidak Diketahui',
          kategori: p['Kategori'] || 'Umum',
          harga: p['Harga'] || 0,
          deskripsi: p['Deskripsi'] || 'Deskripsi tidak tersedia.',
          gambar: p['Gambar (URL)'] || 'https://via.placeholder.com/600x400?text=No+Image'
        }));
        filteredProducts = [...allProducts];
        renderCategories();
        renderProducts();
        updateCartBadge();
      })
      .catch(error => {
        console.error('Error:', error);
        document.getElementById('product-grid').innerHTML = '<p class="text-center">Gagal memuat data.</p>';
      });

    // Render produk
    function renderProducts() {
      const grid = document.getElementById('product-grid');
      grid.innerHTML = '';
      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const pageProducts = filteredProducts.slice(start, end);
      pageProducts.forEach((product, index) => {
        const card = document.createElement('div');
        card.className = 'col fade-in';
        card.style.animationDelay = `${index * 0.1}s`;
        card.innerHTML = `
          <div class="card product-card h-100">
            <img src="${product.gambar}" class="card-img-top" alt="Gambar ${product.nama}" loading="lazy">
            <div class="card-body">
              <h5 class="card-title">${product.nama}</h5>
              <p class="card-text text-muted">${product.kategori}</p>
              <p class="card-text text-danger fw-bold">Rp ${Number(product.harga).toLocaleString('id-ID')}</p>
            </div>
          </div>
        `;
        card.addEventListener('click', () => {
          const params = new URLSearchParams({
            nama: product.nama,
            kategori: product.kategori,
            harga: product.harga,
            deskripsi: product.deskripsi,
            gambar: product.gambar
          });
          window.location.href = `detail.html?${params.toString()}`;
        });
        grid.appendChild(card);
      });
      renderPagination();
    }

    // Render pagination
    function renderPagination() {
      const pagination = document.getElementById('pagination');
      pagination.innerHTML = '';
      const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
      for (let i = 1; i <= totalPages; i++) {
        const li = document.createElement('li');
        li.className = `page-item ${i === currentPage ? 'active' : ''}`;
        li.innerHTML = `<a class="page-link" href="#">${i}</a>`;
        li.addEventListener('click', (e) => {
          e.preventDefault();
          currentPage = i;
          renderProducts();
        });
        pagination.appendChild(li);
      }
    }

    // Render kategori dropdown
    function renderCategories() {
      const categories = [...new Set(allProducts.map(p => p.kategori))];
      const menu = document.getElementById('category-menu');
      menu.innerHTML = '<li><a class="dropdown-item" href="#" data-kategori="all">Semua</a></li>';
      categories.forEach(cat => {
        const li = document.createElement('li');
        li.innerHTML = `<a class="dropdown-item" href="#" data-kategori="${cat}">${cat}</a>`;
        li.addEventListener('click', (e) => {
          e.preventDefault();
          const selected = e.target.dataset.kategori;
          filteredProducts = selected === 'all' ? [...allProducts] : allProducts.filter(p => p.kategori === selected);
          currentPage = 1;
          renderProducts();
        });
        menu.appendChild(li);
      });
    }

    // Search
    document.getElementById('search-input').addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase();
      filteredProducts = allProducts.filter(p => p.nama.toLowerCase().includes(query));
      currentPage = 1;
      renderProducts();
    });

    // Dark mode toggle
    document.getElementById('darkModeToggle').addEventListener('change', (e) => {
      document.body.setAttribute('data-theme', e.target.checked ? 'dark' : 'light');
      localStorage.setItem('theme', e.target.checked ? 'dark' : 'light');
    });
    // Load saved theme
    if (localStorage.getItem('theme') === 'dark') {
      document.getElementById('darkModeToggle').checked = true;
      document.body.setAttribute('data-theme', 'dark');
    }

    // Cart functions
    function getCart() {
      return JSON.parse(localStorage.getItem('cart') || '[]');
    }

    function updateCartBadge() {
      const cart = getCart();
      const badge = document.getElementById('cart-badge');
      badge.textContent = cart.length;
      badge.style.display = cart.length > 0 ? 'block' : 'none';
    }

    // Render cart in modal
    document.getElementById('cart-btn').addEventListener('click', () => {
      const cart = getCart();
      const list = document.getElementById('cart-list');
      list.innerHTML = '';
      let total = 0;
      cart.forEach((item, index) => {
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        li.innerHTML = `
          <div>
            <img src="${item.gambar}" alt="${item.nama}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px; margin-right: 10px;">
            ${item.nama} - Rp ${Number(item.harga).toLocaleString('id-ID')}
          </div>
          <button class="btn btn-sm btn-danger remove-item" data-index="${index}">Hapus</button>
        `;
        list.appendChild(li);
        total += Number(item.harga);
      });
      document.getElementById('cart-total').textContent = total.toLocaleString('id-ID');
      // Remove item
      document.querySelectorAll('.remove-item').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const index = e.target.dataset.index;
          let cart = getCart();
          cart.splice(index, 1);
          localStorage.setItem('cart', JSON.stringify(cart));
          updateCartBadge();
          e.target.closest('li').remove(); // Update UI
          total -= Number(cart[index]?.harga || 0); // Update total
          document.getElementById('cart-total').textContent = total.toLocaleString('id-ID');
        });
      });
    });

    // Clear cart
    document.getElementById('clear-cart').addEventListener('click', () => {
      localStorage.removeItem('cart');
      updateCartBadge();
      document.getElementById('cart-list').innerHTML = '';
      document.getElementById('cart-total').textContent = '0';
    });
  </script>
</body>
</html>
